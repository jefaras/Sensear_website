---
name: Next.js Hydration Error Debugger
description: A systematic approach to debugging common React hydration mismatch errors in Next.js Server Components.
---

# Next.js Hydration Error Debugger

Hydration errors occur when the HTML server-rendered by Next.js does not match the HTML generated by React on the client during the initial render. 

When a user reports a hydration error, or you see one in the dev server logs, follow these steps systematically:

1. **Verify Browser Extensions:**
   - Often, browser extensions (like grammar checkers, password managers, or ad blockers) inject DOM nodes (like `<div>` or `<style>`) into the page before React hydrates.
   - Instruct the user to open the page in an Incognito/Private Browsing window with extensions disabled. If the error disappears, it's an extension issue and can generally be ignored in development.

2. **Check for Invalid HTML Nesting:**
   - Use the `grep_search` tool to look for common invalid nesting patterns in the component tree, such as:
     - `<a>` inside another `<a>`
     - `<div>` inside a `<p>`
     - block-level elements inside inline elements

3. **Check for Unsafe Third-Party Scripts:**
   - Look for any third-party scripts loaded without the Next.js `next/script` component.
   - Ensure external scripts aren't directly mutating the DOM before hydration completes.

4. **Identify `typeof window` Checks:**
   - Use `grep_search` to find `typeof window !== 'undefined'` or `window` object usage.
   - If a component renders differently based on `window` existence on initial load, it will cause a hydration error.
   - **Fix:** Move the client-side logic into a `useEffect` hook, or dynamically import the component with `ssr: false`.

5. **Examine Suspense Boundaries:**
   - Check if the affected area uses `React.Suspense` correctly. If Client Components containing asynchronous state aren't wrapped properly, it can cause mismatches.

6. **Fix Date/Time Functions:**
   - Using `new Date().toLocaleString()` or similar functions directly in the initial render will almost always mismatch because the server timezone might differ from the client timezone.
   - **Fix:** Use a `useEffect` to set the date, or use a consistent formatting library/strategy on both ends.

7. **Propose the Fix:**
   - Once identified, use `replace_file_content` to fix the component.
   - Instruct the user to verify by starting the dev server (`npm run dev`) and checking the browser console.
